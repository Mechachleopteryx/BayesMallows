---
title: "Pairwise Comparisons"
author: "Oystein Sorensen"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
bibliography: ../inst/REFERENCES.bib
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
set.seed(33232)
```

## Working with Pairwise Comparisons
Pairwise comparisons are described in Section 4.2 of @vitelli2018. Let us start by considering a toy example with two assessors and five items. Assessor 1 has stated a set of preferences
$$ \mathcal{B}_{1} = \left\{A_{1} \prec A_{2}, A_{2} \prec A_{5}, A_{4} \prec A_{5} \right\} $$
and assessor 2 has the set of preferences
$$ \mathcal{B}_{2} = \left\{ A_{3} \prec A_{2}, A_{4} \prec A_{5} \right\}. $$

### Data Model
Each time an assessor is asked to compare two object, a measurement is made. Therefore, in order to keep order data *tidy* (@wickham2014), we define a dataframe in which each row correspond to one pairwise comparison. The columns (variables) are *the assessor*, *the bottom item*, and *the top item*. 

In the code snippet below, we defined such a dataframe:

```{r, message=FALSE, results='asis'}
library(BayesMallows)
library(dplyr)
pair_comp <- tribble(
  ~Assessor, ~BottomItem, ~TopItem,
  1, 1, 2,
  1, 2, 5,
  1, 4, 5,
  2, 3, 2,
  2, 4, 5
)

knitr::kable(pair_comp)
```

### Generating the Transitive Closure

Next, we need to find the transitive closure for the set of pairwise comparisons given by each user. `BayesMallows` comes with a function `generate_transitive_closure` to do just this. The function also needs to know the total number of items, but ranked and unranked.


```{r}
pair_comp_tc <- generate_transitive_closure(pair_comp, num_items = 5)
```

As we can see, `pair_comp_tc` has an additional row containing the relation $A_{4} \prec A_{5}$. For assessor 2, $\text{tc}(\mathcal{B}_{2}) = \mathcal{B}_{2}$, so no new rows needed to be added.

```{r, echo=FALSE, results='asis'}
knitr::kable(pair_comp_tc)
```

## Mallows Model with Pairwise Preferences
Having generated the transitive closure of each assessor's pairwise preferences, we can go on and use these as input to the Mallows model.

# References
